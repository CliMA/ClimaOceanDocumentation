<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Public ¬∑ ClimaOcean.jl</title><meta name="title" content="Public ¬∑ ClimaOcean.jl"/><meta property="og:title" content="Public ¬∑ ClimaOcean.jl"/><meta property="twitter:title" content="Public ¬∑ ClimaOcean.jl"/><meta name="description" content="Documentation for ClimaOcean.jl."/><meta property="og:description" content="Documentation for ClimaOcean.jl."/><meta property="twitter:description" content="Documentation for ClimaOcean.jl."/><meta property="og:url" content="https://clima.github.io/ClimaOceanDocumentation/dev/library/public/"/><meta property="twitter:url" content="https://clima.github.io/ClimaOceanDocumentation/dev/library/public/"/><link rel="canonical" href="https://clima.github.io/ClimaOceanDocumentation/dev/library/public/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ClimaOcean.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../literated/inspect_ecco_data/">Inspect ECCO2 data</a></li><li><a class="tocitem" href="../../literated/generate_bathymetry/">Generate bathymetry</a></li><li><a class="tocitem" href="../../literated/generate_surface_fluxes/">Surface fluxes</a></li><li><a class="tocitem" href="../../literated/single_column_os_papa_simulation/">Single column simulation</a></li><li><a class="tocitem" href="../../literated/near_global_ocean_simulation/">Near-global Ocean simulation</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../outline/">Contents</a></li><li class="is-active"><a class="tocitem" href>Public</a><ul class="internal"><li><a class="tocitem" href="#ClimaOcean"><span>ClimaOcean</span></a></li><li><a class="tocitem" href="#Diagnostics"><span>Diagnostics</span></a></li><li><a class="tocitem" href="#InitialConditions"><span>InitialConditions</span></a></li><li><a class="tocitem" href="#DataWrangling"><span>DataWrangling</span></a></li><li><a class="tocitem" href="#ECCO"><span>ECCO</span></a></li><li><a class="tocitem" href="#Bathymetry"><span>Bathymetry</span></a></li></ul></li><li><a class="tocitem" href="../internals/">Private</a></li><li><a class="tocitem" href="../function_index/">Function index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Library</a></li><li class="is-active"><a href>Public</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Public</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaOcean.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/ClimaOcean.jl/blob/main/docs/src/library/public.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Public-Documentation"><a class="docs-heading-anchor" href="#Public-Documentation">Public Documentation</a><a id="Public-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Public-Documentation" title="Permalink"></a></h1><p>Documentation for <code>ClimaOcean.jl</code>&#39;s public interface.</p><p>See the Internals section of the manual for internal package docs covering all submodules.</p><h2 id="ClimaOcean"><a class="docs-heading-anchor" href="#ClimaOcean">ClimaOcean</a><a id="ClimaOcean-1"></a><a class="docs-heading-anchor-permalink" href="#ClimaOcean" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.ClimaOcean" href="#ClimaOcean.ClimaOcean"><code>ClimaOcean.ClimaOcean</code></a> ‚Äî <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>&lt;!‚Äì Title ‚Äì&gt; &lt;h1 align=&quot;center&quot;&gt;   ClimaOcean.jl &lt;/h1&gt;</p><p>&lt;!‚Äì description ‚Äì&gt; &lt;p align=&quot;center&quot;&gt;   &lt;strong&gt;üåé A framework for realistic ocean-only and coupled ocean + sea-ice simulations driven by prescribed atmospheres and based on &lt;a href=https://github.com/CliMA/Oceananigans.jl&gt;Oceananigans&lt;/a&gt; and &lt;a href=https://github.com/CliMA/ClimaSeaIce.jl&gt;ClimaSeaIce&lt;/a&gt;&lt;/strong&gt;.  &lt;/p&gt;</p><p><strong></strong></p><p><a href="https://doi.org/10.5281/zenodo.7677442"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.7677442.svg?style=flat-square" alt="DOI"/></a> <a href="https://clima.github.io/ClimaOceanDocumentation/dev"><img src="https://img.shields.io/badge/documentation-in%20development-orange?style=flat-square" alt="Documentation"/></a> <a href="https://buildkite.com/clima/climaocean-ci"><img src="https://badge.buildkite.com/3113cca353b83df3b5855d3f0d69827124614aef7017c835d2.svg?style=flat-square" alt="Build status"/></a></p><p><strong>Installation</strong></p><p>ClimaOcean is a registered package. To install from a Julia REPL:</p><pre><code class="language-julia hljs">julia&gt; using Pkg

julia&gt; Pkg.add(&quot;ClimaOcean&quot;)

julia&gt; Pkg.instantiate()</code></pre><p>Use <code>Pkg.add(&quot;url=https://github.com/CliMA/ClimaOcean.jl.git&quot;, rev=&quot;main&quot;)</code> to install the latest version of <code>ClimaOcean</code>. For more information, see the <a href="https://pkgdocs.julialang.org">documentation for <code>Pkg.jl</code></a>.</p><p><strong>Why? What&#39;s the difference between ClimaOcean and <a href="https://github.com/CliMA/Oceananigans.jl">Oceananigans</a>?</strong></p><p>Oceananigans is a general-purpose library for ocean-flavored fluid dynamics.  ClimaOcean implements a framework for driving realistic Oceananigans simulations with prescribed atmospheres, and coupling them to prognostic sea ice simulations.</p><p><strong>A core abstraction: <code>ClimaOcean.OceanSeaIceModel</code></strong></p><p>Our system for realistic modeling is anchored by <code>ClimaOcean.OceanSeaIceModel</code>, which encapsulates the ocean simulation, sea ice simulation, prescribed atmospheric state, and specifies how the three communicate. To illustrate how <code>OceanSeaIceModel</code> works we set up a simulation on a grid with 10 vertical levels and 1/4-degree horizontal resolution:</p><pre><code class="language-julia hljs">using Oceananigans
using Oceananigans.Units
using Dates, CFTime
import ClimaOcean

arch = GPU()
grid = LatitudeLongitudeGrid(arch,
                             size = (1440, 560, 10),
                             halo = (7, 7, 7),
                             longitude = (0, 360),
                             latitude = (-70, 70),
                             z = (-3000, 0))

bathymetry = ClimaOcean.regrid_bathymetry(grid) # builds gridded bathymetry based on ETOPO1
grid = ImmersedBoundaryGrid(grid, GridFittedBottom(bathymetry))

# Build an ocean simulation initialized to the ECCO state estimate on Jan 1, 1993
ocean = ClimaOcean.ocean_simulation(grid)
date  = DateTimeProlepticGregorian(1993, 1, 1)
set!(ocean.model, T = ClimaOcean.ECCOMetadata(:temperature; date),
                  S = ClimaOcean.ECCOMetadata(:salinity; date))

# Build and run an OceanSeaIceModel (with no sea ice component) forced by JRA55 reanalysis
atmosphere = ClimaOcean.JRA55_prescribed_atmosphere(arch)
coupled_model = ClimaOcean.OceanSeaIceModel(ocean; atmosphere)
simulation = Simulation(coupled_model, Œît=5minutes, stop_time=30days)
run!(simulation)</code></pre><p>The simulation above achieves approximately 8 simulated years per day of wall time on an Nvidia H100 GPU.</p><p>Since <code>ocean.model</code> is an <code>Oceananigans.HydrostaticFreeSurfaceModel</code>, we can leverage <code>Oceananigans</code> features in our scripts. For example, to plot the surface speed at the end of the simulation we write</p><pre><code class="language-julia hljs">u, v, w = ocean.model.velocities
speed = Field(sqrt(u^2 + v^2))
compute!(speed)

using GLMakie
heatmap(view(speed, :, :, ocean.model.grid.Nz), colorrange=(0, 0.5), colormap=:magma, nan_color=:lightgray)</code></pre><p>which produces</p><p><img src="https://github.com/user-attachments/assets/4c484b93-38fe-4840-bf7d-63a3a59d29e1" alt="image"/></p><p><strong>Additional features: a utility for <code>ocean_simulation</code>s and data wrangling</strong></p><p>A second core abstraction in ClimaOcean is <code>ocean_simulation</code>. <code>ocean_simulation</code> configures an Oceananigans model for realistic simulations including temperature and salinity, the TEOS-10 equation of state, boundary conditions to store computed air-sea fluxes, the automatically-calibrated turbulence closure <code>CATKEVerticalDiffusivity</code>, and the <a href="http://doi.org/10.1029/2023MS004130"><code>WENOVectorInvariant</code> advection scheme</a> for mesoscale-turbulence-resolving simulations.</p><p>ClimaOcean also provides convenience features for wrangling datasets of bathymetry, ocean temperature, salinity, ocean velocity fields, and prescribed atmospheric states.</p><p>ClimaOcean is built on top of Oceananigans and <a href="https://github.com/CliMA/ClimaSeaIce.jl">ClimaSeaIce</a>, so it&#39;s important that ClimaOcean users become proficient with <a href="https://github.com/CliMA/Oceananigans.jl">Oceananigans</a>. Note that though ClimaOcean is currently focused on hydrostatic modeling with <code>Oceananigans.HydrostaticFreeSurfaceModel</code>, realistic nonhydrostatic modeling is also within the scope of this package.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/ClimaOcean.jl#L4-L102">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.@distribute-Tuple{Any}" href="#ClimaOcean.@distribute-Tuple{Any}"><code>ClimaOcean.@distribute</code></a> ‚Äî <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@distribute for i in iterable
    ...
end</code></pre><p>Distribute a <code>for</code> loop among different ranks</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/distributed_utils.jl#L61-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.@handshake-Tuple{Any}" href="#ClimaOcean.@handshake-Tuple{Any}"><code>ClimaOcean.@handshake</code></a> ‚Äî <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@handshake exs...</code></pre><p>perform <code>exs</code> on all ranks, but only one rank at a time, where ranks <code>r2 &gt; r1</code> wait for rank <code>r1</code> to finish before executing <code>exs</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/distributed_utils.jl#L96-L101">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.@onrank-Tuple{Any}" href="#ClimaOcean.@onrank-Tuple{Any}"><code>ClimaOcean.@onrank</code></a> ‚Äî <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@onrank rank, exs...</code></pre><p>Perform <code>exp</code> only on rank <code>rank</code> Other ranks will wait for the root rank to finish before continuing. The expression is run anyways if MPI in not initialized</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/distributed_utils.jl#L35-L41">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.@root-Tuple{Any}" href="#ClimaOcean.@root-Tuple{Any}"><code>ClimaOcean.@root</code></a> ‚Äî <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@root exs...</code></pre><p>Perform <code>exs</code> only on rank 0, otherwise know as &quot;root&quot; rank. Other ranks will wait for the root rank to finish before continuing</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/distributed_utils.jl#L14-L19">source</a></section></article><h2 id="Diagnostics"><a class="docs-heading-anchor" href="#Diagnostics">Diagnostics</a><a id="Diagnostics-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.Diagnostics.MixedLayerDepthField-Tuple{Any, Any, Any}" href="#ClimaOcean.Diagnostics.MixedLayerDepthField-Tuple{Any, Any, Any}"><code>ClimaOcean.Diagnostics.MixedLayerDepthField</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MixedLayerDepthField(grid, tracers, buoyancy_model; Œîb = 3e-4, field_kw...)</code></pre><p>Return a reduced <code>Field{Center, Center, Nothing}</code> that represents mixed layer depth for <code>model</code>, based on a buoyancy differential criterion. The mixed layer depth is defined as the depth <span>$h$</span> for which</p><p class="math-container">\[b(z=0) - b(z=-h) = Œîb\]</p><p>This criterion is solved by integrating downwards and linearly interpolating to find <code>h</code>, assuming that <span>$b$</span> decreases with depth.</p><p><strong>Keyword arguments</strong></p><ul><li><code>Œîb</code>: Buoyancy differential used to calculate mixed layer depth</li><li><code>field_kw</code>: Keyword arguments passed to <code>Field</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">h = MixedLayerDepth(model)
compute!(h) # compute mixed layer depth</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/Diagnostics.jl#L77-L104">source</a></section></article><h2 id="InitialConditions"><a class="docs-heading-anchor" href="#InitialConditions">InitialConditions</a><a id="InitialConditions-1"></a><a class="docs-heading-anchor-permalink" href="#InitialConditions" title="Permalink"></a></h2><h2 id="DataWrangling"><a class="docs-heading-anchor" href="#DataWrangling">DataWrangling</a><a id="DataWrangling-1"></a><a class="docs-heading-anchor-permalink" href="#DataWrangling" title="Permalink"></a></h2><h2 id="ECCO"><a class="docs-heading-anchor" href="#ECCO">ECCO</a><a id="ECCO-1"></a><a class="docs-heading-anchor-permalink" href="#ECCO" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCOMetadata" href="#ClimaOcean.DataWrangling.ECCO.ECCOMetadata"><code>ClimaOcean.DataWrangling.ECCO.ECCOMetadata</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct ECCOMetadata{D, V}</code></pre><p>Metadata information for an ECCO dataset:</p><ul><li><code>name</code>: The name of the dataset.</li><li><code>dates</code>: The dates of the dataset, in an <code>AbstractCFDateTime</code> format.</li><li><code>version</code>: The version of the dataset, could be <code>ECCO2Monthly</code>, <code>ECCO2Daily</code>, or <code>ECCO4Monthly</code>.</li><li><code>dir</code>: The directory where the dataset is stored.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_metadata.jl#L16-L24">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCOMetadata-Tuple{Symbol}" href="#ClimaOcean.DataWrangling.ECCO.ECCOMetadata-Tuple{Symbol}"><code>ClimaOcean.DataWrangling.ECCO.ECCOMetadata</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ECCOMetadata(name::Symbol; 
             dates = DateTimeProlepticGregorian(1993, 1, 1),
             version = ECCO4Monthly(),
             dir = download_ECCO_cache)</code></pre><p>Construct an <code>ECCOMetadata</code> object with the specified parameters.</p><p><strong>Arguments</strong></p><ul><li><code>name::Symbol</code>: The name of the metadata.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>dates</code>: The date(s) of the metadata. Note this can either be a single date,          representing a snapshot, or a range of dates, representing a time-series.          Default: <code>DateTimeProlepticGregorian(1993, 1, 1)</code>.</p></li><li><p><code>version</code>: The data version. Supported versions are <code>ECCO2Monthly()</code>, <code>ECCO2Daily()</code>,            or <code>ECCO4Monthly()</code>.</p></li><li><p><code>dir</code>: The directory of the data file. Default: <code>download_ECCO_cache</code>.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_metadata.jl#L47-L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCORestoring-Tuple{Oceananigans.Architectures.AbstractArchitecture, Symbol}" href="#ClimaOcean.DataWrangling.ECCO.ECCORestoring-Tuple{Oceananigans.Architectures.AbstractArchitecture, Symbol}"><code>ClimaOcean.DataWrangling.ECCO.ECCORestoring</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ECCORestoring([arch=CPU(),]
              variable_name::Symbol;
              version=ECCO4Monthly(),
              dates=all_ECCO_dates(version),
              dates = all_ECCO_dates(version), 
              time_indices_in_memory = 2, 
              time_indexing = Cyclical(),
              mask = 1,
              rate = 1,
              grid = nothing,
              inpainting = NearestNeighborInpainting(prod(size(metadata))))</code></pre><p>Create a forcing term that restores to values stored in an ECCO field time series. The restoring is applied as a forcing on the right hand side of the evolution equations calculated as</p><pre><code class="language-julia hljs">F = mask ‚ãÖ rate ‚ãÖ (ECCO_variable - simulation_variable[i, j, k])</code></pre><p>where <code>ECCO_variable</code> is linearly interpolated in space and time from the ECCO dataset of choice to the  simulation grid and time.</p><p><strong>Arguments</strong></p><ul><li><p><code>arch</code>: The architecture. Typically <code>CPU()</code> or <code>GPU()</code>. Default: <code>CPU()</code>.</p></li><li><p><code>variable_name</code>: The name of the variable to restore. Choices include:</p><ul><li><code>:temperature</code>,</li><li><code>:salinity</code>,</li><li><code>:u_velocity</code>,</li><li><code>:v_velocity</code>,</li><li><code>:sea_ice_thickness</code>,</li><li><code>:sea_ice_area_fraction</code>.</li></ul></li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>version</code>: The version of the ECCO dataset. Default: <code>ECCO4Monthly()</code>.</p></li><li><p><code>dates</code>: The dates to use for the ECCO dataset. Default: <code>all_ECCO_dates(version)</code>.</p></li><li><p><code>time_indices_in_memory</code>: The number of time indices to keep in memory; trade-off between performance                           and memory footprint.    </p></li><li><p><code>time_indexing</code>: The time indexing scheme for the field time series‚â•</p></li><li><p><code>mask</code>: The mask value. Can be a function of <code>(x, y, z, time)</code>, an array, or a number.</p></li><li><p><code>rate</code>: The restoring rate, i.e., the inverse of the restoring timescale (in s‚Åª¬π).</p></li><li><p><code>time_indices_in_memory:</code> how many time instances are loaded in memory; the remaining are loaded lazily.</p></li><li><p><code>grid</code>: if not a <code>nothing</code>, the ECCO data is directly interpolated on the <code>grid</code>.</p></li><li><p><code>inpainting</code>: inpainting algorithm, see <a href="../internals/#ClimaOcean.DataWrangling.inpaint_mask!-Tuple{Any, Any}"><code>inpaint_mask!</code></a>. Default: <code>NearestNeighborInpainting(Inf)</code>.</p></li><li><p><code>grid</code>: If <code>isnothing(grid)</code>, ECCO data is interpolated on-the-fly to the simulation grid.         If <code>!isnothing(grid)</code>, ECCO data is pre-interpolated to <code>grid</code>.         Default: nothing.</p></li></ul><p>It is possible to also pass an <code>ECCOMetadata</code> type as the first argument without the need for the  <code>variable_name</code> argument and the <code>version</code> and <code>dates</code> keyword arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_restoring.jl#L234-L297">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.LinearlyTaperedPolarMask-Tuple{}" href="#ClimaOcean.DataWrangling.ECCO.LinearlyTaperedPolarMask-Tuple{}"><code>ClimaOcean.DataWrangling.ECCO.LinearlyTaperedPolarMask</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">LinearlyTaperedPolarMask(; northern = (70,   75),
                           southern = (-75, -70),
                           z = (-20, 0))</code></pre><p>Build a mask that is linearly tapered in latitude inbetween the northern and southern edges. The mask is constant in depth between the z and is equal to zero everywhere else. The mask has the following functional form:</p><pre><code class="language-julia hljs">n = 1 / (northern[2] - northern[1]) * (œÜ - northern[1])
s = 1 / (southern[1] - southern[2]) * (œÜ - southern[2])

within_depth = (z[1] &lt; z &lt; z[2])

mask = within_depth ? max(n, s, 0) : 0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_mask.jl#L86-L103">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCO_field-Tuple{ECCOMetadata}" href="#ClimaOcean.DataWrangling.ECCO.ECCO_field-Tuple{ECCOMetadata}"><code>ClimaOcean.DataWrangling.ECCO.ECCO_field</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ECCO_field(metadata::ECCOMetadata;
           architecture = CPU(),
           horizontal_halo = (3, 3))</code></pre><p>Retrieve the ecco field corresponding to <code>metadata</code>.  The data is loaded from <code>filename</code> on <code>architecture</code> with <code>horizontal_halo</code> in the x and y direction. The halo in the z-direction is one.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO.jl#L123-L131">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCO_immersed_grid" href="#ClimaOcean.DataWrangling.ECCO.ECCO_immersed_grid"><code>ClimaOcean.DataWrangling.ECCO.ECCO_immersed_grid</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ECCO_immersed_grid(metadata, architecture = CPU())</code></pre><p>Compute the <code>ImmersedBoundaryGrid</code> for <code>metadata</code> with a bottom height field that is defined  by the first non-missing value from the bottom up.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_mask.jl#L46-L51">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.DataWrangling.ECCO.ECCO_mask" href="#ClimaOcean.DataWrangling.ECCO.ECCO_mask"><code>ClimaOcean.DataWrangling.ECCO.ECCO_mask</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ECCO_mask(architecture = CPU(); minimum_value = Float32(-1e5))</code></pre><p>A boolean field where <code>true</code> represents a missing value in the ECCO dataset.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/DataWrangling/ECCO/ECCO_mask.jl#L7-L11">source</a></section></article><h2 id="Bathymetry"><a class="docs-heading-anchor" href="#Bathymetry">Bathymetry</a><a id="Bathymetry-1"></a><a class="docs-heading-anchor-permalink" href="#Bathymetry" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.Bathymetry.regrid_bathymetry-Tuple{Any}" href="#ClimaOcean.Bathymetry.regrid_bathymetry-Tuple{Any}"><code>ClimaOcean.Bathymetry.regrid_bathymetry</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">regrid_bathymetry(target_grid;
                  url = &quot;https://www.ngdc.noaa.gov/thredds/fileServer/global/ETOPO2022/60s/60s_surface_elev_netcdf&quot;, 
                  height_above_water = &lt;none&gt;,
                  minimum_depth = 0,
                  dir = download_cache,
                  filename = &quot;ETOPO_2022_v1_60s_N90W180_surface.nc&quot;)</code></pre><p>Regrid bathymetry associated with the NetCDF file at <code>path = joinpath(dir, filename)</code> to <code>target_grid</code>. If <code>path</code> does not exist, then a download is attempted from <code>joinpath(url, filename)</code>.</p><p><strong>Arguments</strong></p><ul><li><code>target_grid</code>: grid to interpolate onto</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><p><code>height_above_water</code>: limits the maximum height of above-water topography (where h &gt; 0). If                       <code>nothing</code> the original topography is retained</p></li><li><p><code>minimum_depth</code>: minimum depth for the shallow regions, defined as a positive value.                   <code>h &gt; - minimum_depth</code> will be considered land</p></li><li><p><code>dir</code>: directory of the bathymetry-containing file</p></li><li><p><code>filename</code>: file containing bathymetric data. Must be netcdf with fields:             (1) <code>lat</code> vector of latitude nodes             (2) <code>lon</code> vector of longitude nodes             (3) <code>z</code> matrix of depth values</p></li><li><p><code>interpolation_passes</code>: regridding/interpolation passes. The bathymetry is interpolated in                         <code>interpolation_passes - 1</code> intermediate steps. With more steps the                          final bathymetry will be smoother.</p><p>Example: interpolating from a 400x200 grid to a 100x100 grid in 4 passes involves:</p><ul><li>400x200 ‚Üí 325x175</li><li>325x175 ‚Üí 250x150</li><li>250x150 ‚Üí 175x125</li><li>175x125 ‚Üí 100x100</li></ul><p>If <em>coarsening</em> the original grid, linear interpolation in passes is equivalent to applying a smoothing filter, with more passes increasing the strength of the filter. If <em>refining</em> the original grid, additional passes will not help and no intermediate steps will be performed.</p></li><li><p><code>major_basins</code>: Number of &quot;independent major basins&quot;, or fluid regions fully encompassed by land,                 that are retained by <a href="../internals/#ClimaOcean.Bathymetry.remove_minor_basins!-Tuple{Oceananigans.Fields.Field, Any}"><code>remove_minor_basins!</code></a>. Basins are removed by order of size:                 the smallest basins are removed first. <code>major_basins=1</code> will retain only the largest basin.                 Default: <code>Inf</code>, which does not remove any basins.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/Bathymetry.jl#L33-L85">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ClimaOcean.Bathymetry.retrieve_bathymetry-Tuple{Any, Any}" href="#ClimaOcean.Bathymetry.retrieve_bathymetry-Tuple{Any, Any}"><code>ClimaOcean.Bathymetry.retrieve_bathymetry</code></a> ‚Äî <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">retrieve_bathymetry(grid, filename; kw...)</code></pre><p>Retrieve the bathymetry data from a file or generate it using a grid and save it to a file.</p><p><strong>Arguments</strong></p><ul><li><code>grid</code>: The grid used to generate the bathymetry data.</li><li><code>filename</code>: The name of the file to read or save the bathymetry data.</li><li><code>kw...</code>: Additional keyword arguments.</li></ul><p><strong>Returns</strong></p><ul><li><code>bottom_height</code>: The retrieved or generated bathymetry data.</li></ul><p>If the specified file exists, the function reads the bathymetry data from the file.  Otherwise, it generates the bathymetry data using the provided grid and saves it to the file before returning it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/ClimaOcean.jl/blob/801ba0643d1ed99d1f707432c942bcef69321672/src/Bathymetry.jl#L360-L379">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../outline/">¬´ Contents</a><a class="docs-footer-nextpage" href="../internals/">Private ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 18 November 2024 20:03">Monday 18 November 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
